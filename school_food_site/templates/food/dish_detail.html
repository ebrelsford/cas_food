{% extends "food/base.html" %}
{% load comments thumbnail %}

{% block title %}{{ dish.name }}{% endblock %}
{% block header_title %}{{ dish.name }}{% endblock %}
{% block page_id %}food-details-page{% endblock %}

{% block head_scripts %}
{{ block.super }}
<script>
    $(document).ready(function() {
        $('.photos-list').jcarousel({
            scroll: 1,
            itemFallbackDimension: 170,
        });
    });
</script>
{% endblock %}

{% block content %}
<h1>{{ dish.name }}</h1>
<div>
    <a href="{% url food_dish_update slug=dish.slug %}">
        Edit this dish <img src="{{ MEDIA_URL }}images/doc_edit.png" />
    </a>
</div>

<div class="photos" style="float: right;">
    {% if dish.pictures.count > 0 %}
    <ul class="photos-list jcarousel-skin-photos">
        {% for picture in dish.pictures.all %}
        <li>
            {% thumbnail picture.picture "600x600" as full %}
            <a title="{{ picture.description }}" href="{{ full.url }}" rel="external" class="img-gallery">
                {% thumbnail picture.picture "150x150" as thumb %}
                <img src="{{ thumb.url }}" width="{{ thumb.width }}" height="{{ thumb.height }}" />
                {% endthumbnail %}
            </a>           
            {% endthumbnail %}
        </li>
        {% endfor %}
    </ul>
    {% endif %}
    <a href="{% url food_dish_add_picture slug=dish.slug %}">
        Add a Picture <img src="{{ MEDIA_URL }}images/round_plus.png" />
    </a>
</div>

<div class="nutrition section">
    <table>
        <tr><th colspan="3">Nutrition Facts</th></tr>
        <tr class="labels">
            <td></td>
            <td>amount</td>
            <td>% daily value</td>
        </tr>
        {% for nutritionfact in dish.nutritionfact_set.all %}
        <tr class="nutrition-fact">
            <td class="nutrient">{{ nutritionfact.nutrient.name }}</td>
            <td class="amount number">
                {{ nutritionfact.amount }}
                {% if nutritionfact.amount_unit and nutritionfact.nutrient.name != "calories" %}
                {{ nutritionfact.amount_unit }}
                {% endif %}
            </td>
            <td class="percent-daily-value number">
                {{ nutritionfact.percent_daily_value }}%
            </td>
        </tr>
        {% empty %}
        <tr><td colspan="3">We don't know yet.</td></tr>
        {% endfor %}
    </table>
</div>

{% if dish.callouts.count > 0 %}
<div class="callouts section">
    <ul>
        {% for callout in dish.callouts.all %}
        <li>
        {% if callout.glossary_entry %}
        {% if is_mobile %}
        <a href="{% url glossary_entry_detail slug=callout.glossary_entry.slug %}">
        {% else %}
        <a href="{% url glossary_list %}#{{ callout.glossary_entry.slug }}">
        {% endif %}
        {% endif %}
            {% if callout.icon %}
            {% thumbnail callout.icon "150x150" as thumb %}
            <img src="{{ thumb.url }}" alt="{{ callout.name }}" title="{{ callout.name}}" width="{{ thumb.width }}" height="{{ thumb.height }}" />
            {% endthumbnail %}
            {% else %}
            {{ callout.name }}
            {% endif %}
        {% if callout.glossary_entry %}
        </a>
        {% endif %}
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<div class="section">
    <h2>Ingredients</h2>
    {% for di in dish.get_dishingredients %}
    {{ di.ingredient }}{% if not forloop.last %}, {% endif %}
    {% empty %}
    We don't know yet.
    {% endfor %}
</div>

<div class="section">
    <h2>Production</h2>
    <div>Where is {{ dish.name }} made? How does it get to the school cafeteria?</div>
</div>

<div class="comments section">
    <h2><a name="comments">Comments</a></h2>
    {% if user.is_authenticated %}
    {% render_comment_form for dish %}
    {% else %}
    Please <a href="{% url django.contrib.auth.views.login %}?next={{ request.path }}">log in</a> to comment on this dish.
    {% endif %}

    {% get_comment_count for dish as comment_count %}
    There {% if comment_count == 1 %}is{% else %}are{% endif %} {{ comment_count }} comment{{ comment_count|pluralize }} on this dish.
    {% render_comment_list for dish %}
</div>
{% endblock %}
