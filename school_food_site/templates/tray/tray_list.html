{% load thumbnail %}

{% for tray in tray_list %}
<li class="meal {% cycle odd,even %}">
    <div class="image-wrapper">
        {% thumbnail tray.picture "600x600" as full %}
        <a title="{{ tray.description }}" href="{{ full.url }}" rel="external" class="img-gallery">
            {% thumbnail tray.picture "150x150" as thumb %}
            <img src="{{ thumb.url }}" width="{{ thumb.width }}" height="{{ thumb.height }}" />
            {% endthumbnail %}
        </a>           
        {% endthumbnail %}
    </div>
    <div class="date">{{ tray.date }}</div>
    <div class="description expandable">{{ tray.description }}</div>
    <div class="comments"><a href="{{ tray.get_absolute_url }}">{{ tray.notes.all|length }} comments</a></div>
    <div class="rate-wrapper">Rate this meal: 
        <ul class="rate" data-change-rating-url="{% url tray.views.rate school_slug=school.slug tray_id=tray.id  %}">
            <li class="rating rating-up" data-rating-points="1"></li>
            <li class="rating rating-down" data-rating-points="-1"></li>
        </ul>
        <div class="loading"></div>
        <div class="clear"></div>
        <div class="ratings-results-wrapper">
            <div class="ratings-results{% if tray.user_rated %} already-voted{% endif %}">
                {% if tray.user_rated %}
                <span class="ratings-sum">{{ tray.total_points }}</span> (<span class="ratings-count">{{ tray.total_count }}</span> rating<span class="ratings-plural">{{ tray.total_count|pluralize }}</span>)
                {% else %}
                <span class="ratings-sum"></span> (<span class="ratings-count"></span> rating<span class="ratings-plural"></span>)
                {% endif %}
            </div>
        </div>
    </div>
</li>
{% empty %}
{% comment %}Intentionally blank.{% endcomment %}
{% endfor %}
